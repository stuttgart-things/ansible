---
vars:
  - name: argo-cd-k3s
    file: |
      ---
      deployment_namespace: argo-cd
      helm_repositories:
        argo:
          url: https://argoproj.github.io/argo-helm

      helm_releases:
        argo-cd:
          ref: argo/argo-cd
          version: 7.6.8
          namespace: "{{ deployment_namespace }}"
          ignore: false
          wait: true
          release_values: |
            global:
              domain: {{ ingress_host }}
            configs:
              params:
                server.insecure: true
            server:
              ingress:
                enabled: true
                ingressClassName: nginx
                annotations:
                  nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
                  nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
                extraTls:
                  - hosts:
                    - {{ ingress_host }}
      post_manifests: {}

  - name: ingress-nginx-k3s
    file: |
      ---
      ingress_nginx_version: 4.11.2
      deployment_namespace: ingress-nginx
      helm_repositories:
        ingress-nginx:
          url: https://kubernetes.github.io/ingress-nginx

      helm_releases:
        ingress-nginx:
          ref: ingress-nginx/ingress-nginx
          version: "{{ ingress_nginx_version }}"
          namespace: "{{ deployment_namespace }}"
          ignore: false
          wait: true
          release_values: |
            controller:
              hostNetwork: true