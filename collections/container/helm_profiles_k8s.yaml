---
vars:
  - name: cert-manager
    file: |
      ---
      deployment_namespace: cert-manager
      helm_repositories:
        cert-manager:
          url: https://charts.jetstack.io

      helm_releases:
        cert-manager:
          ref: cert-manager/cert-manager
          version: v1.17.1
          namespace: "{{ deployment_namespace }}"
          ignore: false
          wait: true
          release_values: |
            installCRDs: true

      post_manifests: {}

  - name: ingress-nginx
    file: |
      ---
      ingress_nginx_version: 4.10.1
      deployment_namespace: ingress-nginx
      helm_repositories:
        ingress-nginx:
          url: https://kubernetes.github.io/ingress-nginx

      post_manifests: {}

      helm_releases:
        ingress-nginx:
          ref: ingress-nginx/ingress-nginx
          version: "{{ ingress_nginx_version }}"
          namespace: "{{ deployment_namespace }}"
          ignore: false
          wait: true
          release_values: {}

  - name: rancher
    file: |
      ---
      rancher_version: 2.8.5
      deployment_namespace: cattle-system
      helm_repositories:
        rancher-stable:
          url: https://releases.rancher.com/server-charts/latest

      helm_releases:
        rancher:
          ref: rancher-stable/rancher
          version: "{{ rancher_version }}"
          namespace: "{{ deployment_namespace }}"
          ignore: false
          wait: true
          release_values: |
            ---
            global:
              cattle:
                psp:
                  enabled: false
            bootstrapPassword: {{ password }}
            hostname: {{ hostname }}.{{ domain }}
            privateCA: true
            ingress:
              enabled: true
              ingressClassName: nginx
              servicePort: 80
              tls:
                source: secret
                secretName: {{ hostname }}-tls

  - name: rancher
    file: |
      ---
      deployment_namespace: kube-system
      headlamp_version: 0.33.0
      helm_repositories:
        #headlamp-cert-configuration:
        #  url: ghcr.io/stuttgart-things
        #  oci: true
        headlamp:
          url: https://kubernetes-sigs.github.io/headlamp/

      helm_releases:
        headlamp-cert-configuration:
          ref: oci://ghcr.io/stuttgart-things/sthings-cluster
          version: 0.3.15
          namespace: "{{ deployment_namespace }}"
          ignore: false
          wait: true
          release_values: |
            installCRDs: true
            issuerKind: "{{ headlamp_issuerKind | default('ClusterIssuer') }}"
            clusterIssuer: "{{ headlamp_clusterIssuer | default('selfsigned') }}"
            hostname: {{ headlamp_hostname | default('headlamp.k8scluster)' }}"
            domain: {{ headlamp_domain | default('example.com') }}"

        headlamp:
          ref: headlamp/headlamp
          version: "{{ headlamp_version }}"
          namespace: "{{ deployment_namespace }}"
          ignore: false
          wait: true
          release_values: |
            ingressEnabled: true
            issuerKindAnnotation: "cluster-issuer"
            hostname: {{ headlamp_hostname | default('headlamp.k8scluster)' }}"
            domain: {{ headlamp_domain | default('example.com') }}"
            createCertificateResource: false
            storageEnabled: "{{ headlamp_storageEnabled | default('false') }}"
            storageAccessModes: ReadWriteOnce
            storageClassName: "{{ headlamp_storageClassName | default('local-storage') }}"
            clusterIssuer: "{{ headlamp_clusterIssuer | default('selfsigned') }}"
            storageSize: "{{ headlamp_storageSize | default('1Gi') }}"
            version: "{{ headlamp_version }}"

      post_manifests: {}
